## Марка Skip If
Марка Skip If, что понятно из названия, позволяет пропустить тест при выполнения условия. Условие указывается первым аргументом. Также можно указать причину, по которой мы пропускаем тест. К примеру, `reason="Condition"`.

```python 
@pytest.mark.skipif()
def some_test():
    pass
```

## Pytest Hooks (Хуки)
Хуки в Pytest — специальные функции, которые выполняются в разные моменты жизни теста. В отличии от некоторых других фреймворков, в Pytest есть возможность влиять на тест во время его выполнения. Также важно учитывать, что хуки применимы в основном в больших проектах. В простых тестах они бывают лишними.

Основные хуки в Pytest:
- `pytest_addoption` — добавляет новые функции;
- `pytest_configure` — изменяет конфигурацию;
- `pytest_sessionstart` — действия перед стартом всех тестов;
- `pytest_generate_tests` — изменяем параметризацию тестов;
- `pytest_collection_modifyitems` — редактирование собранных тестов;
- `pytest_runtestloop` — хуки во время выполнения тестов;
- `pytest_sessionfinish` — все тесты завершились.

Все хуки в Pytest прописываются в файле `conftest.py`.

Дерево последовательности выполнения тестов и вызова хуков ([ссылка](https://github.com/pytest-dev/pytest/issues/3261#issuecomment-369740536)):

```
root
└── pytest_cmdline_main
    ├── pytest_plugin_registered
    ├── pytest_configure
    │   └── pytest_plugin_registered
    ├── pytest_sessionstart
    │   ├── pytest_plugin_registered
    │   └── pytest_report_header
    ├── pytest_collection
    │   ├── pytest_collectstart
    │   ├── pytest_make_collect_report
    │   │   ├── pytest_collect_file
    │   │   │   └── pytest_pycollect_makemodule
    │   │   └── pytest_pycollect_makeitem
    │   │       └── pytest_generate_tests
    │   │           └── pytest_make_parametrize_id
    │   ├── pytest_collectreport
    │   ├── pytest_itemcollected
    │   ├── pytest_collection_modifyitems
    │   └── pytest_collection_finish
    │       └── pytest_report_collectionfinish
    ├── pytest_runtestloop
    │   └── pytest_runtest_protocol
    │       ├── pytest_runtest_logstart
    │       ├── pytest_runtest_setup
    │       │   └── pytest_fixture_setup
    │       ├── pytest_runtest_makereport
    │       ├── pytest_runtest_logreport
    │       │   └── pytest_report_teststatus
    │       ├── pytest_runtest_call
    │       │   └── pytest_pyfunc_call
    │       ├── pytest_runtest_teardown
    │       │   └── pytest_fixture_post_finalizer
    │       └── pytest_runtest_logfinish
    ├── pytest_sessionfinish
    │   └── pytest_terminal_summary
    └── pytest_unconfigure
```

## Параллельное выполнение тестов
Для успешного параллельных тестов важно помнить:
- тесты не должны зависеть друг от друга;
- тесты не должны менять окружение так, чтобы это влияло на прохождение других тестов.

Для параллельного запуска тестов используется плагин xdist, который разрабатывается командой Pytest. У xdist есть аргументы запуска. Основным таким аргументом является `-n numprocesses`, который принимает количество параллелей для запуска. Также можно передать `auto` для автоматической настройки. Остальные аргументы ситуативные и редко используются, получить информация о них можно с помощью команды `help`.

**Пример:**
К примеру, у нас есть тест, который выполняется 20 раз и каждое выполнение занимает одну секунду:

```python
@pytest.mark.parametrize("param", range(20))
def test_many_params(param, session_scoped_fixture):
    time.sleep(1)
```

Если запустить тест обычным способом с помощью команды `pytest -v -k test_many_params`, то тесты начнут выполнятся поочерёдно и это займет приблизительно 20 секунд. Если этот же тест запустить с помощью команды `pytest -v -k test_many_params -n 2`, то тесты будут запускаться в два потока и на выполнение уже понадобится в два раза меньше времени.
