# Selenoid 

## Введение в Docker

Если описать максимально просто, Docker — легковесные виртуальные машины, которые часто называют контейнерами. А если ещё проще, то это компьютер, запущенный внутри компьютера.

Docker устанавливается на хост-машину и уже тогда может запускать контейнеры, которых может быть несколько и они могут работать одновременно. Внутри контейнеров могут запускаться разные программы и на разных языках. Работать они могут одновременно. У каждого контейнера есть жизненный цикл.

![](https://raw.githubusercontent.com/qa-guru/knowledge-base/main/img/python/les13/les13-1.png)

**Почему это удобно:**
- У каждого запущенного контейнера своя файловая система и доступ к файлам имеет только один контейнер;
- Все необходимые зависимости уже собрано в контейнер и их не надо устанавливать отдельно;
- После удаления контейнера удаляется всё содержимое этих контейнеров и хост-машина остаётся чистой.

**Откуда берутся Docker-контейнеры**
Контейнеры берутся из Docker-образов, которые содержат в себе всё необходимое. С помощью команды `docker run` можно развернуть контейнер. Образы можно найти на официальной [странице](https://hub.docker.com). С помощью команды `docker pull <name>` можно локально скачать образ.

**Как создаются образы**
Образы создаются из Dockerfile, который представляет собой обычный текстовый файл. К примеру, он может выглядеть так:

```docker
FROM ubuntu

RUN apt-get update && apt-get -y install nginx

CMD ["nginx", "-g", "daemon off;"]
```

Для создания из Docker-образа из Dockerfile используют команду `docker build`, а уже после этого образ можно развернуть в контейнер с помощью `docker run`.

**Изоляции**
Ещё раз важно отметить, что у каждого контейнера своя файловая система, которая не пересекается с общей. Также у каждого контейнера свой сетевой интерфейс. При этом есть возможность связать локальные файловую систему и сетевой интерфейс с общими.

### Краткий список команд

Создать образ:
```bash
docker build -t <имя_образа> <путь_до_папки_с_Dockerfile>
```

Запустить контейнер из образа:
```bash
docker run -d --name <имя_контейнера> -p <порт_на_хосте>:<порт_в_контейнере> -v <папка_на_хосте>:<папка_в_контейнере> <имя_образа>
```

Список всех контейнеров:
```bash
docker ps -a
```

Зайти внутрь контейнера:
```bash
docker exec -it <имя_контейнера> /bin?sh
```

Остановить и удалить контейнер:
```bash
docker rm -f <имя_контейнера>
```

Docker для разных операционных систем можно найти и скачать по [ссылке](https://www.docker.com/products/docker-desktop).

## Selenium

### Что это и зачем нужен
Если говорить простыми словами, то Selenium позволяет с помощью кода повторить действия реального пользователя в браузере. Это помогает автоматизировать тестирование. С помощью Selenium обычно тестируют веб-сайты и веб-приложения. Можно тестировать и приложения для Android, но это сложнее.

**Какие проблемы есть у Selenium:**
- Нет возможности на одном сервере запустить сразу две версии одного браузера, что часто бывает необходимо в тестах;
- Кэш, история и временные файлы остаются в памяти;
- Низкая стабильность.

## Selenoid 
Selenoid решает все эти проблемы и представляет собой альтернативу для Selenium-сервера, но при этом полностью совместим с Selenium. При переходе на Selenoid не надо переписывать тесты. Рядом с Selenoid всегда должен стоять Docker, который открывает браузеры.

## Как установить Selenoid
> Важно: на процессорах Apple M1/M2 Selenoid не будет работать, так как все браузеры собраны под архитектуру x86

Подробную текстовую инструкцию по запуску можно найти по [ссылке](https://aerokube.com/cm/latest/).

1. Перейти на [GitHub](https://github.com/aerokube/cm/releases/tag/1.8.1) и установить последнюю версию утилиты под свою операционную систему.
2. С помощью команды `./cm selenoid start --vnc` запустить Selenoid.
3. Интерфейс Selenoid можно запустить с помощью команды `./cm selenoid-ui start`.

## Запускаем тесты на Selenoid

В коде теста необходимо обозначить адрес Selenoid, на котором будет запускаться тест. К примеру:

```python
drier = web.driver.Remote(desired_capabilities, command_executor='http://188.166.98.123:4444/wd/hub')
```

После запуска теста запустится новая сессия в Selenoid, в которой выполнится тест.

